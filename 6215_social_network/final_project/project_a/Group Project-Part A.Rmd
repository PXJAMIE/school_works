---
title: "Group Project(Part A)"
author: "Group 9"
date: "2/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load packages and read into data
```{r}
library(readxl)
library(igraph)
attributes <- read_excel("Attributes.xlsx")
collab <- read_excel("Collab.xlsx")
info <- read_excel("InfoSeek.xlsx")
```

## Display data
```{r}
attributes
```
```{r}
info
```
```{r}
collab
```
info: information seeking relationship and c
collab: ollaboration relationship
The higher the number the more is the strength of the relationship. attribute: individual's department, management level, tenure, gender, satisfaction with individual productivity , satisfaction with group productivity, satisfaction with organizational productivity.

# Build network project and visualize
```{r}
info.m <- as.matrix(info)
collab.m <- as.matrix(collab)
infog <- graph.data.frame(info.m)
collabg <- graph.data.frame(collab.m)
```
summary the network
```{r}
summary(infog)
```
```{r}
summary(collabg)
```
Add the attributes to the network
```{r}
for (i in V(infog)) {
  for (j in names(attributes)) {
    infog <- set.vertex.attribute(infog, j, index=i, attributes[i,j])
  }
}
```

```{r}
for (i in V(collabg)) {
  for (j in names(attributes)) {
    collabg <- set.vertex.attribute(collabg, j, index=i, attributes[i,j])
  }
}
```

Plot the network
```{r}
plot(infog)
```
```{r}
plot(collabg)
```

## Network Metrics Analysis
make the network undirected
```{r}
uinfog <- as.undirected(infog)
ucollabg <- as.undirected(collabg)
```

### InfoSeek network

A network diameter is the longest geodesic distance (length of the shortest path between two nodes) in the network.
```{r}
diameter(uinfog)
```

Average path length is the mean of the shortest distance between each pair of nodes in the network (for undirected graphs).
```{r}
mean_distance(uinfog, directed=F)
```

Network Size
```{r}
vcount(uinfog)
ecount(uinfog)
```

Compute network density 
```{r}
edge_density(uinfog, loops=TRUE) 
```

Obtain the degree distribution and show it
```{r}
degree_uinfog <- degree(uinfog)
hist(sort(degree_uinfog))
```

Obtain the cumulative degree distribution and show it
```{r}
degree_disti <- degree.distribution(uinfog, cumulative=TRUE)
degree_disti
```

Plot the degree distribution and see if it fits the power law
```{r}
pwri <- power.law.fit(degree_uinfog)
plot(degree_disti,log="xy",
     ylim=c(.01,10),
     bg="black",pch=21,
     xlab="Degree",
     ylab="Cumulative Frequency")

# And the expected power law distribution
lines(1:20,10*(1:20)^((-pwri$alpha)+1))
```

```{r}
transitivity(uinfog)
```

### Collaboration network

A network diameter is the longest geodesic distance (length of the shortest path between two nodes) in the network.
```{r}
diameter(ucollabg)
```

Average path length is the mean of the shortest distance between each pair of nodes in the network (for undirected graphs).
```{r}
mean_distance(ucollabg, directed=F)
```

Network Size
```{r}
vcount(ucollabg)
ecount(ucollabg)
```

Compute network density 
```{r}
edge_density(ucollabg, loops=TRUE) 
```

Obtain the degree distribution and show it
```{r}
degree_ucollabg <- degree(ucollabg)
hist(sort(degree_ucollabg))
```

Obtain the cumulative degree distribution and show it
```{r}
degree_distc <- degree.distribution(ucollabg, cumulative=TRUE)
degree_distc
```

Plot the degree distribution and see if it fits the power law
```{r}
pwrc <- power.law.fit(degree_ucollabg)
plot(degree_distc,log="xy",
     ylim=c(.01,10),
     bg="black",pch=21,
     xlab="Degree",
     ylab="Cumulative Frequency")

# And the expected power law distribution
lines(1:20,10*(1:20)^((-pwrc$alpha)+1))
```

```{r}
transitivity(ucollabg)
```

## Centralities Calculation
### 1) infoSeek
#### Degree centrality

```{r}
seedvalue <- 1234
deg <- degree(infog, mode = "all")
deg
V(infog)$size <- deg*4 
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Closeness centrality

```{r}
clo <- closeness(infog)
clo
V(infog)$size <- clo*600 
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Betweenness centrality

```{r}
bet <- betweenness(infog)
bet
V(infog)$size <- bet
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Edge Betweenness centrality

```{r}
ebe <- edge.betweenness(infog)
ebe
V(infog)$size <- ebe
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Eigenvector centrality

```{r}
eig <- eigen_centrality(infog)
eig
V(infog)$size <- eig$vector*20
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Page Rank centrality

```{r}
pag <- page_rank(infog)
pag
V(infog)$size <- pag$vector*100
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Kleinberg - authority

```{r}
hub <- authority_score(infog)$vector
hub
V(infog)$size <- hub*20
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Kleinberg - hub

```{r}
hub <- hub_score(infog)$vector
hub
V(infog)$size <- pag$vector*150
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

#### Bonacich power centrality

```{r}
pow <- power_centrality(infog,exponent=.2)
pow
V(infog)$size <- pow*10
E(infog)$arrow.size <- 0.2
E(infog)$edge$color <- "gray"
set.seed(seedvalue)
plot(infog)
```

### 2) Collaboration
#### Degree centrality

```{r}
deg_C <- degree(collabg, mode = "all")
deg_C
V(collabg)$size <- deg_C*4 
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Closeness centrality

```{r}
clo_C <- closeness(collabg)
clo_C
V(collabg)$size <- clo_C*600 
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Betweenness centrality

```{r}
bet_C<- betweenness(collabg)
bet_C
V(collabg)$size <- bet_C
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Edge Betweenness centrality

```{r}
ebe <- edge.betweenness(collabg)
ebe
V(collabg)$size <- ebe
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Eigenvector centrality

```{r}
eig <- eigen_centrality(collabg)
eig
V(collabg)$size <- eig$vector*20
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Page Rank centrality

```{r}
pag <- page_rank(collabg)
pag
V(collabg)$size <- pag$vector*100
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Kleinberg - authority

```{r}
hub <- authority_score(collabg)$vector
hub
V(collabg)$size <- hub*20
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Kleinberg - hub

```{r}
hub <- hub_score(collabg)$vector
hub
V(collabg)$size <- pag$vector*150
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

#### Bonacich power centrality

```{r}
pow <- power_centrality(collabg,exponent=.2)
pow
V(collabg)$size <- pow*10
E(collabg)$arrow.size <- 0.2
E(collabg)$edge$color <- "gray"
set.seed(seedvalue)
plot(collabg)
```

## Comparison of centrality
### 1) InfoSeek
#### degree vs. betweenness

```{r}
library(ggplot2)
infog_B_D <- data.frame(infog_degree=deg, infog_betweenness=bet)
ggplot(infog_B_D, aes(x=infog_degree, y=infog_betweenness)) +geom_point(color="red", size=4)+labs(x = "Degree", y="Betweenness")
```

#### degree vs. closeness

```{r}
infog_C_D <- data.frame(infog_degree=deg, infog_closeness=clo)
ggplot(infog_C_D, aes(x=infog_degree, y=infog_closeness)) +geom_point(color="red", size=4)+labs(x = "Degree", y="Closeness")
```

#### betweenness vs. closeness

```{r}
infog_B_C <- data.frame(infog_closeness=clo, infog_betweenness=bet)
ggplot(infog_B_C, aes(x=infog_closeness, y=infog_betweenness)) +geom_point(color="red", size=4)+labs(x = "Betweeneness", y="Closeness")
```

### 2) collaboration
#### degree vs. betweenness

```{r}
collabg_B_D_C <- data.frame(collabg_degree=deg_C, collabg_betweenness=bet_C)
ggplot(collabg_B_D_C, aes(x=collabg_degree, y=collabg_betweenness)) +geom_point(color="red", size=4)+labs(x = "Degree", y="Betweenness")
```

#### degree vs. closeness

```{r}
collabg_C_D_C <- data.frame(collabg_degree=deg_C, collabg_closeness=clo_C)
ggplot(collabg_C_D_C, aes(x=collabg_degree, y=collabg_closeness)) +geom_point(color="red", size=4)+labs(x = "Degree", y="Closeness")
```

#### betweenness vs. closeness

```{r}
collabg_B_C_C <- data.frame(collabg_closeness=clo_C, collabg_betweenness=bet_C)
ggplot(collabg_B_C_C, aes(x=collabg_closeness, y=collabg_betweenness)) +geom_point(color="red", size=4)+labs(x = "Betweeneness", y="Closeness")
```

## Community Analysis
### InfoSeek
```{r}
library(statnet)
```

#### Edge betweenness
```{r}
set.seed(seedvalue)
eb <- edge.betweenness.community(uinfog)
plot (eb,uinfog)
```

#### Leading eigen vector
```{r}
set.seed(seedvalue)
ev <- leading.eigenvector.community(uinfog)
plot (ev,uinfog)
```


#### Fast greedy
```{r}
set.seed(seedvalue)
fg <- fastgreedy.community(uinfog)
plot (fg,uinfog)
```

#### Walktrap
```{r}
set.seed(seedvalue)
wt <- walktrap.community(uinfog)
plot (wt,uinfog)
```

### Collaboration
#### Edge betweenness
```{r}
set.seed(seedvalue)
eb <- edge.betweenness.community(ucollabg)
plot (eb,ucollabg)
```

#### Leading eigen vector
```{r}
set.seed(seedvalue)
ev <- leading.eigenvector.community(ucollabg)
plot (ev,ucollabg)
```
#### Fast greedy
```{r}
set.seed(seedvalue)
fg <- fastgreedy.community(ucollabg)
plot (fg,ucollabg)
```

#### Walktrap
```{r}
set.seed(seedvalue)
wt <- walktrap.community(ucollabg)
plot (wt,ucollabg)
```
### block modeling based on both collaboration and infoSeek networks
```{r}
library(sna)
```

```{r}
collab1 <- collab.m[,-1]
rownames(collab1) <- collab.m[,1]
collabm <- mapply(collab1, FUN=as.numeric)
collabm <- matrix(data=collabm, ncol=109, nrow=109)
info1 <- info.m[,-1]
rownames(info1) <- info.m[,1]
infom <- mapply(info1, FUN=as.numeric)
infom <- matrix(data=infom, ncol=109, nrow=109)
```

Create two network objects
```{r}
collab2 <- network(collabm,directed=TRUE)
info2 <- as.matrix(infom,directed=TRUE)
```

Obtain equivatent node objects by creating an equiv.clust object
```{r}
eq <- equiv.clust(list(collab2,info2), mode="digraph")
```

```{r}
plot(eq)
```

Create an idealized blockmodel using block density at a set level of height from our dendrogram OR as we have done here, specify the number of blocks using the "k =" argument
```{r}
b <- blockmodel(collab2, eq, k=5)
```

See the block vector and block membership
```{r}
b$order.vector
b$block.membership
```

Plot the block model in matrix form
```{r}
plot(b)
```
### Identify the block and the relationships between the blocks. 
Based on collaboration
```{r}
den1 <- network.density(collab2)
```

Prepare to obtain the image matrix
```{r}
bimage1 <- b$block.model
bimage1
```

Blocks with density less than overall network
density are reduced to zero
```{r}
bimage1[bimage1 < den1] <- 0   
bimage1
bimage1[is.nan(bimage1)] <- 1
bimage1
```

View the plot
```{r}
gplot(bimage1, diag=TRUE, 
      edge.lwd=bimage1*5, 
      label=colnames(bimage1),
      vertex.cex=sqrt(table(b$block.membership))*2,
      gmode="digraph", vertex.sides=50,
      vertex.col=gray(1-diag(bimage1)/2))
```
Based on InfoSeek
```{r}
infon <- network(infom,directed=TRUE)
den2 <- network.density(infon)
b2 <- blockmodel(infon, eq, k=4)
bimage2 <- b2$block.model
bimage2

# Blocks with density less than overall network
# density are reduced to zero
bimage2[bimage2 < den2] <- 0   
bimage2
bimage2[is.nan(bimage2)] <- 1
bimage2

# View the plot
gplot(bimage2, diag=TRUE, 
      edge.lwd=bimage2*5, 
      label=colnames(bimage2),
      vertex.cex=sqrt(table(b2$block.membership))*2,
      gmode="digraph", vertex.sides=50,
      vertex.col=gray(1-diag(bimage2)/2))
```


## Describe matrix
```{r}
netDesc <- function(adjMat) {
  if (dim(adjMat)[1] == dim(adjMat)[2]) {
    n <- dim(adjMat)[1]
    numx <- n*(n-1)/2
    minx <- min(adjMat)
    maxx <- max(adjMat)
    sumx <- sum(adjMat)
    meanx <- mean(adjMat)
    stdx <- sd(adjMat)
    varx <- stdx * stdx
    enrmx <- sqrt(sum(adjMat^2))
    colsumx <- colSums(adjMat)
    rowsumx <- rowSums(adjMat)
    rowsdx <- apply(adjMat, 1, sd)
    colsdx <- apply(adjMat, 2, sd)
    return(list(n=n,min=minx,max=maxx,
                sum=sumx,std=stdx,var=varx,
                eucnorm=enrmx,
                rowsum=rowsumx,rowsd=rowsdx,
                colsum=colsumx,colsd=colsdx))
  }
  else 
    return("Not a square matrix")
}
```

```{r}
collab1 <- collab.m[,-1]
rownames(collab1) <- collab.m[,1]
collabm <- mapply(collab1, FUN=as.numeric)
collabm <- matrix(data=collabm, ncol=109, nrow=109)
info1 <- info.m[,-1]
rownames(info1) <- info.m[,1]
infom <- mapply(info1, FUN=as.numeric)
infom <- matrix(data=infom, ncol=109, nrow=109)
```

```{r}
netDesc(collabm)
```

```{r}
netDesc(infom)
```

## QAP analysis
```{r}
library(network)
library(NetData)
library(sna)
library(intergraph)
```

```{r}
summary(infog)
```
```{r}
summary(collabg)
```
```{r}
infog <- asNetwork(infog)
```
```{r}
collabg <- asNetwork(collabg)
```

## Regression

Fit a netlm model
```{r}
nl <- netlm(collabg,list(infog),reps=100)
```

Examine the results
```{r}
summary(nl)
```
